{"ast":null,"code":"import jwt from \"jsonwebtoken\";\nimport isEmail from \"validator/lib/isEmail\";\nimport bcrypt from \"bcrypt\";\nimport validateUserData from \"../../utils/validateUserData\";\nimport connectToDatabase from \"../../utils/connectToDatabase\";\nexport default (async (req, res) => {\n  if (!req.body) return res.status(204).end();\n  const {\n    error,\n    validatedUserData\n  } = validateUserData(req.body, {\n    minimumLengthForEachField: {\n      username: 5,\n      password: 8\n    } // hasEmail: isEmail(JSON.parse(req.body.username)),\n\n  });\n  console.log(JSON.parse(req.body));\n  if (error) return res.status(403).json({\n    ok: false,\n    error\n  });\n  let closeConnection;\n\n  try {\n    validatedUserData.password = await bcrypt.hash(validatedUserData.password, SALT_ROUNDS);\n    const {\n      db,\n      closeConnectionHandler\n    } = await connectToDatabase();\n    closeConnection = closeConnectionHandler;\n    const foundUser = await db.collection(\"users\").findOne({\n      password: validatedUserData.password\n    });\n    if (!foundUser) res.status(403).json({\n      ok: false,\n      error: \"Datele pe care le-ați introdus nu au fost corecte.\"\n    });else res.status(200).json({\n      ok: true\n    });\n    return closeConnection();\n  } catch (e) {\n    if (closeConnection) closeConnection();\n    console.error(e);\n    return res.status(500).json({\n      ok: false\n    });\n  }\n});","map":{"version":3,"sources":["C:/Users/plesa/Desktop/Proiecte Web/infoplus/pages/api/login.js"],"names":["jwt","isEmail","bcrypt","validateUserData","connectToDatabase","req","res","body","status","end","error","validatedUserData","minimumLengthForEachField","username","password","console","log","JSON","parse","json","ok","closeConnection","hash","SALT_ROUNDS","db","closeConnectionHandler","foundUser","collection","findOne","e"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,gBAAP,MAA6B,8BAA7B;AACA,OAAOC,iBAAP,MAA8B,+BAA9B;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC/B,MAAI,CAACD,GAAG,CAACE,IAAT,EAAe,OAAOD,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBC,GAAhB,EAAP;AACf,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA;AAAT,MAA+BR,gBAAgB,CAACE,GAAG,CAACE,IAAL,EAAW;AAC5DK,IAAAA,yBAAyB,EAAE;AACvBC,MAAAA,QAAQ,EAAE,CADa;AAEvBC,MAAAA,QAAQ,EAAE;AAFa,KADiC,CAK5D;;AAL4D,GAAX,CAArD;AAOAC,EAAAA,OAAO,CAACC,GAAR,CAAYC,IAAI,CAACC,KAAL,CAAWb,GAAG,CAACE,IAAf,CAAZ;AACA,MAAIG,KAAJ,EAAW,OAAOJ,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBW,IAAhB,CAAqB;AAAEC,IAAAA,EAAE,EAAE,KAAN;AAAaV,IAAAA;AAAb,GAArB,CAAP;AAEX,MAAIW,eAAJ;;AACA,MAAI;AACAV,IAAAA,iBAAiB,CAACG,QAAlB,GAA6B,MAAMZ,MAAM,CAACoB,IAAP,CAAYX,iBAAiB,CAACG,QAA9B,EAAwCS,WAAxC,CAAnC;AACA,UAAM;AAAEC,MAAAA,EAAF;AAAMC,MAAAA;AAAN,QAAiC,MAAMrB,iBAAiB,EAA9D;AACAiB,IAAAA,eAAe,GAAGI,sBAAlB;AACA,UAAMC,SAAS,GAAG,MAAMF,EAAE,CACrBG,UADmB,CACR,OADQ,EAEnBC,OAFmB,CAEX;AAAEd,MAAAA,QAAQ,EAAEH,iBAAiB,CAACG;AAA9B,KAFW,CAAxB;AAGA,QAAI,CAACY,SAAL,EACIpB,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBW,IAAhB,CAAqB;AACjBC,MAAAA,EAAE,EAAE,KADa;AAEjBV,MAAAA,KAAK,EAAE;AAFU,KAArB,EADJ,KAKKJ,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBW,IAAhB,CAAqB;AAAEC,MAAAA,EAAE,EAAE;AAAN,KAArB;AAEL,WAAOC,eAAe,EAAtB;AACH,GAfD,CAeE,OAAOQ,CAAP,EAAU;AACR,QAAIR,eAAJ,EAAqBA,eAAe;AAEpCN,IAAAA,OAAO,CAACL,KAAR,CAAcmB,CAAd;AACA,WAAOvB,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBW,IAAhB,CAAqB;AAAEC,MAAAA,EAAE,EAAE;AAAN,KAArB,CAAP;AACH;AACJ,CAlCD","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport isEmail from \"validator/lib/isEmail\";\r\nimport bcrypt from \"bcrypt\";\r\nimport validateUserData from \"../../utils/validateUserData\";\r\nimport connectToDatabase from \"../../utils/connectToDatabase\";\r\n\r\nexport default async (req, res) => {\r\n    if (!req.body) return res.status(204).end();\r\n    const { error, validatedUserData } = validateUserData(req.body, {\r\n        minimumLengthForEachField: {\r\n            username: 5,\r\n            password: 8,\r\n        },\r\n        // hasEmail: isEmail(JSON.parse(req.body.username)),\r\n    });\r\n    console.log(JSON.parse(req.body));\r\n    if (error) return res.status(403).json({ ok: false, error });\r\n\r\n    let closeConnection;\r\n    try {\r\n        validatedUserData.password = await bcrypt.hash(validatedUserData.password, SALT_ROUNDS);\r\n        const { db, closeConnectionHandler } = await connectToDatabase();\r\n        closeConnection = closeConnectionHandler;\r\n        const foundUser = await db\r\n            .collection(\"users\")\r\n            .findOne({ password: validatedUserData.password });\r\n        if (!foundUser)\r\n            res.status(403).json({\r\n                ok: false,\r\n                error: \"Datele pe care le-ați introdus nu au fost corecte.\",\r\n            });\r\n        else res.status(200).json({ ok: true });\r\n\r\n        return closeConnection();\r\n    } catch (e) {\r\n        if (closeConnection) closeConnection();\r\n\r\n        console.error(e);\r\n        return res.status(500).json({ ok: false });\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}