{"ast":null,"code":"import connectToDatabaseThen from \"../../utils/connectToDatabase\";\nimport checkFieldsValidity from \"../../utils/checkFieldsValidity\";\nimport escape from \"validator/lib/escape\";\nexport default (async (req, res) => {\n  let isError = false;\n  req.body = escapeRegisterData(JSON.parse(req.body));\n  if (checkFieldsValidity({\n    fields: req.body,\n    minimumLengthForEachField: {\n      name: 3,\n      surname: 3,\n      username: 5,\n      password: 8\n    },\n    hasEmail: true\n  }) !== false) return res.status(403).json({\n    ok: false\n  });\n  connectToDatabaseThen(db => {\n    try {\n      const users = db.collection(\"users\");\n      throw new Error(\"test error\");\n      users.findOne({}, error => {\n        if (error) {\n          console.error(error);\n          isError = true;\n        }\n      });\n    } catch (e) {\n      isError = true;\n    }\n  });\n  if (isError) return res.status(500).json({\n    ok: false\n  });\n  res.status(200).json({\n    ok: true\n  });\n});\n\nfunction escapeRegisterData(userData) {\n  for (const [key, value] of Object.entries(userData)) userData[key] = escape(value);\n\n  return userData;\n}","map":{"version":3,"sources":["C:/Users/plesa/Desktop/Proiecte Web/infoplus/pages/api/register.js"],"names":["connectToDatabaseThen","checkFieldsValidity","escape","req","res","isError","body","escapeRegisterData","JSON","parse","fields","minimumLengthForEachField","name","surname","username","password","hasEmail","status","json","ok","db","users","collection","Error","findOne","error","console","e","userData","key","value","Object","entries"],"mappings":"AAAA,OAAOA,qBAAP,MAAkC,+BAAlC;AACA,OAAOC,mBAAP,MAAgC,iCAAhC;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC/B,MAAIC,OAAO,GAAG,KAAd;AAEAF,EAAAA,GAAG,CAACG,IAAJ,GAAWC,kBAAkB,CAACC,IAAI,CAACC,KAAL,CAAWN,GAAG,CAACG,IAAf,CAAD,CAA7B;AACA,MACIL,mBAAmB,CAAC;AAChBS,IAAAA,MAAM,EAAEP,GAAG,CAACG,IADI;AAEhBK,IAAAA,yBAAyB,EAAE;AACvBC,MAAAA,IAAI,EAAE,CADiB;AAEvBC,MAAAA,OAAO,EAAE,CAFc;AAGvBC,MAAAA,QAAQ,EAAE,CAHa;AAIvBC,MAAAA,QAAQ,EAAE;AAJa,KAFX;AAQhBC,IAAAA,QAAQ,EAAE;AARM,GAAD,CAAnB,KASO,KAVX,EAYI,OAAOZ,GAAG,CAACa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,IAAAA,EAAE,EAAE;AAAN,GAArB,CAAP;AAEJnB,EAAAA,qBAAqB,CAAEoB,EAAD,IAAQ;AAC1B,QAAI;AACA,YAAMC,KAAK,GAAGD,EAAE,CAACE,UAAH,CAAc,OAAd,CAAd;AACA,YAAM,IAAIC,KAAJ,CAAU,YAAV,CAAN;AACAF,MAAAA,KAAK,CAACG,OAAN,CAAc,EAAd,EAAmBC,KAAD,IAAW;AACzB,YAAIA,KAAJ,EAAW;AACPC,UAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACApB,UAAAA,OAAO,GAAG,IAAV;AACH;AACJ,OALD;AAMH,KATD,CASE,OAAOsB,CAAP,EAAU;AACRtB,MAAAA,OAAO,GAAG,IAAV;AACH;AACJ,GAboB,CAArB;AAcA,MAAIA,OAAJ,EAAa,OAAOD,GAAG,CAACa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,IAAAA,EAAE,EAAE;AAAN,GAArB,CAAP;AACbf,EAAAA,GAAG,CAACa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,IAAAA,EAAE,EAAE;AAAN,GAArB;AACH,CAlCD;;AAoCA,SAASZ,kBAAT,CAA4BqB,QAA5B,EAAsC;AAClC,OAAK,MAAM,CAACC,GAAD,EAAMC,KAAN,CAAX,IAA2BC,MAAM,CAACC,OAAP,CAAeJ,QAAf,CAA3B,EACIA,QAAQ,CAACC,GAAD,CAAR,GAAgB3B,MAAM,CAAC4B,KAAD,CAAtB;;AAEJ,SAAOF,QAAP;AACH","sourcesContent":["import connectToDatabaseThen from \"../../utils/connectToDatabase\";\r\nimport checkFieldsValidity from \"../../utils/checkFieldsValidity\";\r\nimport escape from \"validator/lib/escape\";\r\n\r\nexport default async (req, res) => {\r\n    let isError = false;\r\n\r\n    req.body = escapeRegisterData(JSON.parse(req.body));\r\n    if (\r\n        checkFieldsValidity({\r\n            fields: req.body,\r\n            minimumLengthForEachField: {\r\n                name: 3,\r\n                surname: 3,\r\n                username: 5,\r\n                password: 8,\r\n            },\r\n            hasEmail: true,\r\n        }) !== false\r\n    )\r\n        return res.status(403).json({ ok: false });\r\n\r\n    connectToDatabaseThen((db) => {\r\n        try {\r\n            const users = db.collection(\"users\");\r\n            throw new Error(\"test error\");\r\n            users.findOne({}, (error) => {\r\n                if (error) {\r\n                    console.error(error);\r\n                    isError = true;\r\n                }\r\n            });\r\n        } catch (e) {\r\n            isError = true;\r\n        }\r\n    });\r\n    if (isError) return res.status(500).json({ ok: false });\r\n    res.status(200).json({ ok: true });\r\n};\r\n\r\nfunction escapeRegisterData(userData) {\r\n    for (const [key, value] of Object.entries(userData))\r\n        userData[key] = escape(value);\r\n\r\n    return userData;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}